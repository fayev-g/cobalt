# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
default_stages: [pre-commit]

default_language_version:
    python: python3

files: |
    (?x)^(
        (.*/)?cobalt/.*|
        (.*/)?starboard/.*|
        .github/.*|
        .pre-commit-config.yaml|
        .pylintrc|
        docker-compose.yaml|
    )$
exclude: |
    (?x)^(
        (
            starboard/contrib/RDK|
        )/
    )

repos:
-   repo: https://cobalt.googlesource.com/pre-commit-hooks
    rev: v5.0.0
    hooks:
    -   id: check-case-conflict
    -   id: check-xml
        exclude: |
            (?x)^(
                cobalt/shell/android/javatests/AndroidManifest.xml
            )
    -   id: check-yaml
    -   id: check-json
    -   id: end-of-file-fixer
    -   id: mixed-line-ending
    -   id: trailing-whitespace
-   repo: local
    hooks:
    -   id: chromium-pre-commit # To test: pre-commit run --hook-stage manual chromium-pre-commit
        name: Chromium presubmit bridge
        entry: ./third_party/depot_tools/vpython3 --vpython-spec=./third_party/depot_tools/.vpython3 ./cobalt/precommit/run_chromium_presubmits.py
        language: system
        types: [file]
        files: ^.*$ # Apply to all file paths
        stages: [manual] # Require manual run for testing
    -   id: clang-format
        name: clang-format
        entry: clang-format
        language: python
        types: [c++]
        args: [-i, -style=file]
        exclude: |
            (?x)(
                ^starboard/shared/uikit/accessibility_extension.cc$|
                ^starboard/shared/uikit/player_configuration.cc$
            )
        additional_dependencies: ['clang-format==17.0.1']
    -   id: cpplint
        name: cpplint
        entry: cpplint
        language: python
        types: [c++]
        args: [--verbose=4, --quiet]
        exclude: |
            (?x)(
                ^cobalt/bindings/(templates|generated)/|
                ^starboard/shared/uikit/.*\.h$|
                ^cobalt/browser/cobalt_web_contents_observer.h$|
                ^cobalt/common/features/starboard_features_initialization.cc$|
                ^media/mojo/clients/starboard/starboard_renderer_client_factory.cc$|
                ^cobalt/browser/metrics/cobalt_metrics_log_uploader.h$|
                ^starboard/common/check_op.cc$|
                ^starboard/nplb/posix_compliance/posix_lstat_test.cc$|
                ^starboard/shared/starboard/player/file_cache_reader.cc$|
                ^cobalt/media/audio/cobalt_audio_device_factory.h$|
                ^cobalt/media/audio/cobalt_audio_renderer_sink.h$|
                ^cobalt/browser/h5vcc_experiments/h5vcc_experiments_impl.cc$|
                ^cobalt/common/libc/tz/parse_posix_tz_test.cc$|
                ^starboard/crashpad_wrapper/annotations.h$|
                ^starboard/nplb/player_test_util.cc$|
                ^starboard/nplb/posix_compliance/posix_sys_statvfs_test.cc$|
                ^cobalt/browser/metrics/cobalt_metrics_service_client.h$|
                ^starboard/no_platform/configuration_public.h$|
                ^third_party/blink/renderer/modules/cobalt/h5vcc_runtime/h_5_vcc_runtime.h$|
                ^chromecast/starboard/media/media/starboard_api_wrapper_15.cc$|
                ^cobalt/common/libc/time/icu_time_support.cc$|
                ^cobalt/browser/cobalt_browser_main_parts.h$|
                ^starboard/android/shared/audio_renderer_tunnel.h$|
                ^starboard/common/scoped_timer.h$|
                ^starboard/nplb/posix_compliance/posix_file_get_path_info_test.cc$|
                ^chromecast/starboard/media/cdm/starboard_decryptor_cast.cc$|
                ^chromecast/starboard/media/media/starboard_api_wrapper_base.cc$|
                ^chromecast/starboard/media/media/starboard_audio_decoder.cc$|
                ^chromecast/starboard/media/media/starboard_audio_decoder_test.cc$|
                ^chromecast/starboard/media/media/starboard_video_decoder_test.cc$|
                ^cobalt/testing/browser_tests/resource_load_observer.cc$|
                ^starboard/shared/starboard/player/filter/player_components.cc$|
                ^starboard/shared/starboard/player/filter/testing/audio_resampler_test.cc$|
                ^third_party/blink/renderer/modules/cobalt/h5vcc_experiments/h_5_vcc_experiments.h$|
                ^starboard/crashpad_wrapper/wrapper.h$
            )
        additional_dependencies: ['cpplint==2.0.2']
    -   id: yapf
        name: yapf
        entry: yapf
        language: python
        types: [python]
        args: [-i, -vv]
        additional_dependencies: ['yapf==0.40.2']
    -   id: pylint
        name: pylint
        entry: pylint
        language: python
        types: [python]
        args: [-d W0201]
        additional_dependencies: ['pylint==3.3.1']
    -   id: python3-compatibility-check
        name: Python 3 Compatibility Check
        entry: python3 ./cobalt/precommit/python3_check.py
        language: python
        types: [python]
    -   id: google-java-format
        name: google-java-format
        entry: python3 ./cobalt/precommit/google_java_format_wrapper.py
        language: python
        types: [java]
        args: [-i]
        # (TODO:b/454687024) Re-enable. Temporarily disabled post m138 merge
        # due to unintended update of java code formatting rules
        exclude: |
            (?x)^(
                starboard/|
                cobalt/
            )
    -   id: gcheckstyle
        name: gcheckstyle
        entry: python3 ./cobalt/precommit/gcheckstyle_wrapper.py
        language: python
        exclude: |
            (?x)^(
                starboard/android/apk/app/src/main/java/dev/cobalt/storage/StorageProto.java|
                cobalt/android/apk/app/src/org/chromium/content_shell/Util.java|
                cobalt/android/apk/app/src/org/chromium/content_shell/Shell.java|
                cobalt/android/apk/app/src/org/chromium/content_shell/ShellManager.java
            )
        types: [java]
    -   id: gn-format
        name: gn-format
        entry: gn format
        language: system
        files: '.*\.gni?$'
